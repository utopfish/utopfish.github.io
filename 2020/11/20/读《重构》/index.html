<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="介绍花了两次读完，6 章到 11 章读起来都想拍大腿，12 章有点水。中间有很多相互矛盾的重构方法，作者想要表示的核心在于，所有的重构方法都是有其代价的，如无必要就一定不要使用。至于什么时候是必要，这就存乎一心，全看个人总结的规则和实际的情况吧。千万不能因为懒不去进行重构，看到问题要跑步前进。里面提到了领域模型，相关的书我也必须加入书单了，还有关于 Stack 错误继承 List 的问题，这里正确">
<meta property="og:type" content="article">
<meta property="og:title" content="读《重构》">
<meta property="og:url" content="http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/index.html">
<meta property="og:site_name" content="非技术博客">
<meta property="og:description" content="介绍花了两次读完，6 章到 11 章读起来都想拍大腿，12 章有点水。中间有很多相互矛盾的重构方法，作者想要表示的核心在于，所有的重构方法都是有其代价的，如无必要就一定不要使用。至于什么时候是必要，这就存乎一心，全看个人总结的规则和实际的情况吧。千万不能因为懒不去进行重构，看到问题要跑步前进。里面提到了领域模型，相关的书我也必须加入书单了，还有关于 Stack 错误继承 List 的问题，这里正确">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-11-20T13:16:50.000Z">
<meta property="article:modified_time" content="2022-11-20T08:09:30.584Z">
<meta property="article:author" content="liu Amon">
<meta property="article:tag" content="重构">
<meta property="article:tag" content="代码">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>读《重构》</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/11/20/%E8%82%A1%E7%A5%A8%E5%A4%A7%E5%81%9A%E6%89%8B%E5%9B%9E%E5%BF%86%E5%BD%95/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2020/11/12/%E8%AF%BB%E3%80%8A%E5%92%A8%E8%AF%A2%E7%9A%84%E5%A5%A5%E7%A7%98%E3%80%8B/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&text=读《重构》"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&is_video=false&description=读《重构》"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=读《重构》&body=Check out this article: http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&name=读《重构》&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&t=读《重构》"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E7%AB%A0-%E7%AC%AC%E4%B8%80%E7%BB%84%E9%87%8D%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">6章 第一组重构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E6%8F%90%E7%82%BC%E5%87%BD%E6%95%B0%EF%BC%88Extract-Function%EF%BC%89"><span class="toc-number">2.0.1.</span> <span class="toc-text">6.1 提炼函数（Extract Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0%EF%BC%88Inline-Function%EF%BC%89"><span class="toc-number">2.0.2.</span> <span class="toc-text">6.2 内联函数（Inline Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%E6%8F%90%E7%82%BC%E5%8F%98%E9%87%8F%EF%BC%88Extract-Variable%EF%BC%89"><span class="toc-number">2.0.3.</span> <span class="toc-text">6.3提炼变量（Extract Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%86%85%E8%81%94%E5%8F%98%E9%87%8F%EF%BC%88Inline-Variable%EF%BC%89"><span class="toc-number">2.0.4.</span> <span class="toc-text">6.4 内联变量（Inline Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-%E6%94%B9%E5%8F%98%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%EF%BC%88Change-Function-Declaration%EF%BC%89"><span class="toc-number">2.0.5.</span> <span class="toc-text">6.5 改变函数声明（Change Function Declaration）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-%E5%B0%81%E8%A3%85%E5%8F%98%E9%87%8F%EF%BC%88Encapsulate-VAriable%EF%BC%89"><span class="toc-number">2.0.6.</span> <span class="toc-text">6.6 封装变量（Encapsulate VAriable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7-%E5%8F%98%E9%87%8F%E6%94%B9%E5%90%8D%EF%BC%88Rename-Variable%EF%BC%89"><span class="toc-number">2.0.7.</span> <span class="toc-text">6.7 变量改名（Rename Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-%E5%BC%95%E5%85%A5%E5%8F%82%E6%95%B0%E5%8F%98%E9%87%8F%EF%BC%88Introduce-Parameter%EF%BC%89"><span class="toc-number">2.0.8.</span> <span class="toc-text">6.8 引入参数变量（Introduce Parameter）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88%E6%88%90%E7%B1%BB%EF%BC%88Combine-Function-into-Classs%EF%BC%89"><span class="toc-number">2.0.9.</span> <span class="toc-text">6.9 函数组合成类（Combine Function into Classs）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E7%AB%A0-%E5%B0%81%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">7章 封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E5%B0%81%E8%A3%85%E8%AE%B0%E5%BD%95%EF%BC%88Encapsulate-Record%EF%BC%89"><span class="toc-number">3.0.1.</span> <span class="toc-text">7.1 封装记录（Encapsulate Record）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%B0%81%E8%A3%85%E9%9B%86%E5%90%88%EF%BC%88Encapsulate-Collection%EF%BC%89"><span class="toc-number">3.0.2.</span> <span class="toc-text">7.2 封装集合（Encapsulate Collection）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E4%BB%A5%E5%AF%B9%E8%B1%A1%E5%8F%96%E4%BB%A3%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%EF%BC%88Replace-Primitive-with-Object%EF%BC%89"><span class="toc-number">3.0.3.</span> <span class="toc-text">7.3 以对象取代基本类型（Replace Primitive with Object）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%8F%96%E4%BB%A3%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F-%EF%BC%88Replace-Temp-with-Query%EF%BC%89"><span class="toc-number">3.0.4.</span> <span class="toc-text">7.4 以查询取代临时变量 （Replace Temp with Query）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-%E6%8F%90%E7%82%BC%E7%B1%BB%EF%BC%88Extract-Class%EF%BC%89"><span class="toc-number">3.0.5.</span> <span class="toc-text">7.5 提炼类（Extract Class）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-%E5%86%85%E8%81%94%E7%B1%BB%EF%BC%88Inline-Class%EF%BC%89"><span class="toc-number">3.0.6.</span> <span class="toc-text">7.6 内联类（Inline Class）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-%E9%9A%90%E8%97%8F%E5%A7%94%E6%89%98%E5%85%B3%E7%B3%BB%EF%BC%88Hide-Delegat%EF%BC%89"><span class="toc-number">3.0.7.</span> <span class="toc-text">7.7 隐藏委托关系（Hide Delegat）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-8-%E7%A7%BB%E9%99%A4%E4%B8%AD%E9%97%B4%E4%BA%BA%EF%BC%88Remove-Middle-Man%EF%BC%89"><span class="toc-number">3.0.8.</span> <span class="toc-text">7.8 移除中间人（Remove Middle Man）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-9-%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%95%EF%BC%88Subtitute-Algorithm%EF%BC%89"><span class="toc-number">3.0.9.</span> <span class="toc-text">7.9 替换算法（Subtitute Algorithm）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E7%AB%A0-%E6%90%AC%E7%A7%BB%E7%89%B9%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text">8章 搬移特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E6%90%AC%E7%A7%BB%E5%87%BD%E6%95%B0"><span class="toc-number">4.0.1.</span> <span class="toc-text">8.1 搬移函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E6%90%AC%E7%A7%BB%E5%AD%97%E6%AE%B5%EF%BC%88Move-Field%EF%BC%89"><span class="toc-number">4.0.2.</span> <span class="toc-text">8.2 搬移字段（Move Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E6%90%AC%E7%A7%BB%E8%AF%AD%E5%8F%A5%E5%88%B0%E5%87%BD%E6%95%B0%EF%BC%88Move-Statements-into-Function%EF%BC%89"><span class="toc-number">4.0.3.</span> <span class="toc-text">8.3 搬移语句到函数（Move Statements into Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E6%90%AC%E7%A7%BB%E8%AF%AD%E5%8F%A5%E5%88%B0%E8%B0%83%E7%94%A8%E8%80%85%EF%BC%88Move-Statements-to-Callers%EF%BC%89"><span class="toc-number">4.0.4.</span> <span class="toc-text">8.4 搬移语句到调用者（Move Statements to Callers）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-%E4%BB%A5%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%8F%96%E4%BB%A3%E5%86%85%E8%81%94%E4%BB%A3%E7%A0%81%EF%BC%88Replace-Inline-Code-with-Function-Call%EF%BC%89"><span class="toc-number">4.0.5.</span> <span class="toc-text">8.5 以函数调用取代内联代码（Replace Inline Code with Function Call）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6-%E7%A7%BB%E5%8A%A8%E8%AF%AD%E5%8F%A5%EF%BC%88Slide-Statements%EF%BC%89"><span class="toc-number">4.0.6.</span> <span class="toc-text">8.6 移动语句（Slide Statements）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-%E6%8B%86%E5%88%86%E5%BE%AA%E7%8E%AF%EF%BC%88Split-Loop%EF%BC%89"><span class="toc-number">4.0.7.</span> <span class="toc-text">8.7 拆分循环（Split Loop）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-%E4%BB%A5%E7%AE%A1%E9%81%93%E5%8F%96%E4%BB%A3%E5%BE%AA%E7%8E%AF%EF%BC%88Replace-Loop-with-Pipeline%EF%BC%89"><span class="toc-number">4.0.8.</span> <span class="toc-text">8.8 以管道取代循环（Replace Loop with Pipeline）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-9-%E7%A7%BB%E9%99%A4%E6%AD%BB%E4%BB%A3%E7%A0%81%EF%BC%88Remove-Dead-Code%EF%BC%89"><span class="toc-number">4.0.9.</span> <span class="toc-text">8.9 移除死代码（Remove Dead Code）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E7%AB%A0-%E9%87%8D%E6%96%B0%E7%BB%84%E7%BB%87%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">9章 重新组织数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-%E6%8B%86%E5%88%86%E5%8F%98%E9%87%8F%EF%BC%88Split-Variable%EF%BC%89"><span class="toc-number">5.0.1.</span> <span class="toc-text">9.1 拆分变量（Split Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-%E5%AD%97%E6%AE%B5%E6%94%B9%E5%90%8D%EF%BC%88Rename-Field%EF%BC%89"><span class="toc-number">5.0.2.</span> <span class="toc-text">9.2 字段改名（Rename Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%8F%96%E4%BB%A3%E6%B4%BE%E7%94%9F%E5%8F%98%E9%87%8F%EF%BC%88Replace-Derived-Variable-with-Query%EF%BC%89"><span class="toc-number">5.0.3.</span> <span class="toc-text">9.3 以查询取代派生变量（Replace Derived Variable with Query）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-4-%E5%B0%86%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%E6%94%B9%E4%B8%BA%E5%80%BC%E5%AF%B9%E8%B1%A1%EF%BC%88Change-Reference-to-Value%EF%BC%89"><span class="toc-number">5.0.4.</span> <span class="toc-text">9.4 将引用对象改为值对象（Change Reference to Value）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-%E5%B0%86%E5%80%BC%E5%AF%B9%E8%B1%A1%E6%94%B9%E4%B8%BA%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%EF%BC%88Change-Value-to-Reference%EF%BC%89"><span class="toc-number">5.0.5.</span> <span class="toc-text">9.5 将值对象改为引用对象（Change Value to Reference）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E7%AB%A0-%E7%AE%80%E5%8C%96%E6%9D%A1%E4%BB%B6%E9%80%BB%E8%BE%91"><span class="toc-number">6.</span> <span class="toc-text">10章 简化条件逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-%E5%88%86%E8%A7%A3%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Decompose-Conditional%EF%BC%89"><span class="toc-number">6.0.1.</span> <span class="toc-text">10.1 分解条件表达式（Decompose Conditional）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-%E5%90%88%E5%B9%B6%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Consilidate-Conditional-Expression%EF%BC%89"><span class="toc-number">6.0.2.</span> <span class="toc-text">10.2 合并条件表达式（Consilidate Conditional Expression）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-%E4%BB%A5%E5%8D%AB%E8%AF%AD%E5%8F%A5%E5%8F%96%E4%BB%A3%E5%B5%8C%E5%A5%97%E6%B7%BB%E5%8A%A0%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Replace-Nested-Conditional-with-Guard-Clauses%EF%BC%89"><span class="toc-number">6.0.3.</span> <span class="toc-text">10.3 以卫语句取代嵌套添加表达式（Replace Nested Conditional with Guard Clauses）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-%E4%BB%A5%E5%A4%9A%E6%80%81%E5%8F%96%E4%BB%A3%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Replace-Conditional-with-Polymorphism%EF%BC%89"><span class="toc-number">6.0.4.</span> <span class="toc-text">10.4 以多态取代条件表达式（Replace Conditional with Polymorphism）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-%E5%BC%95%E5%85%A5%E7%89%B9%E4%BE%8B%EF%BC%88Introduce-Special-Case%EF%BC%89"><span class="toc-number">6.0.5.</span> <span class="toc-text">10.5 引入特例（Introduce Special Case）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-%E5%BC%95%E5%85%A5%E6%96%AD%E8%A8%80%EF%BC%88Introduce-Assertion%EF%BC%89"><span class="toc-number">6.0.6.</span> <span class="toc-text">10.6 引入断言（Introduce Assertion）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E7%AB%A0-%E9%87%8D%E6%9E%84-API"><span class="toc-number">7.</span> <span class="toc-text">11章 重构 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-%E5%B0%86%E6%9F%A5%E8%AF%A2%E5%87%BD%E6%95%B0%E5%92%8C%E4%BF%AE%E6%94%B9%E5%87%BD%E6%95%B0%E5%88%86%E7%A6%BB%EF%BC%88Separate-Query-from-Modifier%EF%BC%89"><span class="toc-number">7.0.1.</span> <span class="toc-text">11.1 将查询函数和修改函数分离（Separate Query from Modifier）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%8C%96%EF%BC%88Parameterize-Function%EF%BC%89"><span class="toc-number">7.0.2.</span> <span class="toc-text">11.2 函数参数化（Parameterize Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-%E7%A7%BB%E9%99%A4%E6%A0%87%E8%AE%B0%E5%8F%82%E6%95%B0%EF%BC%88Remove-Flag-Argument%EF%BC%89"><span class="toc-number">7.0.3.</span> <span class="toc-text">11.3 移除标记参数（Remove Flag Argument）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-%E4%BF%9D%E6%8C%81%E5%AF%B9%E8%B1%A1%E5%AE%8C%E6%95%B4%EF%BC%88Preseve-Whole-Object%EF%BC%89"><span class="toc-number">7.0.4.</span> <span class="toc-text">11.4 保持对象完整（Preseve Whole Object）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-5-%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%8F%96%E4%BB%A3%E5%8F%82%E6%95%B0%EF%BC%88Replace-Parameter-with-Query%EF%BC%89"><span class="toc-number">7.0.5.</span> <span class="toc-text">11.5 以查询取代参数（Replace Parameter with Query）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-6-%E4%BB%A5%E5%8F%82%E6%95%B0%E5%8F%96%E4%BB%A3%E6%9F%A5%E8%AF%A2%EF%BC%88Replace-Query-with-Parameter%EF%BC%89"><span class="toc-number">7.0.6.</span> <span class="toc-text">11.6 以参数取代查询（Replace Query with Parameter）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-7-%E7%A7%BB%E9%99%A4%E8%AE%BE%E5%80%BC%E5%87%BD%E6%95%B0%EF%BC%88Remove-Setting-Method%EF%BC%89"><span class="toc-number">7.0.7.</span> <span class="toc-text">11.7 移除设值函数（Remove Setting Method）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-8-%E4%BB%A5%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0%E5%8F%96%E4%BB%A3%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%EF%BC%88Replace-Constructor-with-Factory-Function%EF%BC%89"><span class="toc-number">7.0.8.</span> <span class="toc-text">11.8 以工厂函数取代构造函数（Replace Constructor with Factory Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-9-%E4%BB%A5%E5%91%BD%E4%BB%A4%E5%8F%96%E4%BB%A3%E5%87%BD%E6%95%B0%EF%BC%88Replace-Function-with-Command%EF%BC%89"><span class="toc-number">7.0.9.</span> <span class="toc-text">11.9 以命令取代函数（Replace Function with Command）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-10-%E4%BB%A5%E5%87%BD%E6%95%B0%E5%8F%96%E4%BB%A3%E5%91%BD%E4%BB%A4%EF%BC%88Replace-Command-with-Function%EF%BC%89"><span class="toc-number">7.0.10.</span> <span class="toc-text">11.10 以函数取代命令（Replace Command with Function）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E7%AB%A0-%E5%A4%84%E7%90%86%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">8.</span> <span class="toc-text">12章 处理继承关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1-%E5%87%BD%E6%95%B0%E4%B8%8A%E7%A7%BB%EF%BC%88Pull-Up-Method%EF%BC%89"><span class="toc-number">8.0.1.</span> <span class="toc-text">12.1 函数上移（Pull Up Method）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-%E5%AD%97%E6%AE%B5%E4%B8%8A%E7%A7%BB%EF%BC%88Pull-Up-Field%EF%BC%89"><span class="toc-number">8.0.2.</span> <span class="toc-text">12.2 字段上移（Pull Up Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-3-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%9C%AC%E4%BD%93%E4%B8%8A%E7%A7%BB%EF%BC%88Pull-Up-Constructor-Body%EF%BC%89"><span class="toc-number">8.0.3.</span> <span class="toc-text">12.3 构造函数本体上移（Pull Up Constructor Body）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-4-%E5%87%BD%E6%95%B0%E4%B8%8B%E7%A7%BB%EF%BC%88Push-Down-Method%EF%BC%89"><span class="toc-number">8.0.4.</span> <span class="toc-text">12.4 函数下移（Push Down Method）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-5-%E5%AD%97%E6%AE%B5%E4%B8%8B%E7%A7%BB%EF%BC%88Push-Down-Field%EF%BC%89"><span class="toc-number">8.0.5.</span> <span class="toc-text">12.5 字段下移（Push Down Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-%E4%BB%A5%E5%AD%90%E7%B1%BB%E5%8F%96%E4%BB%A3%E7%B1%BB%E5%9E%8B%E7%A0%81%EF%BC%88Replace-Type-Code-with-Subclasses%EF%BC%89"><span class="toc-number">8.0.6.</span> <span class="toc-text">12.6 以子类取代类型码（Replace Type Code with Subclasses）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-%E7%A7%BB%E9%99%A4%E5%AD%90%E7%B1%BB%EF%BC%88Remove-Subclass%EF%BC%89"><span class="toc-number">8.0.7.</span> <span class="toc-text">12.7 移除子类（Remove Subclass）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-8-%E6%8F%90%E7%82%BC%E8%B6%85%E7%B1%BB%EF%BC%88Extract-Superclass%EF%BC%89"><span class="toc-number">8.0.8.</span> <span class="toc-text">12.8 提炼超类（Extract Superclass）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-9-%E6%8A%98%E5%8F%A0%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB%EF%BC%88Collapse-Hierarchy%EF%BC%89"><span class="toc-number">8.0.9.</span> <span class="toc-text">12.9 折叠继承体系（Collapse Hierarchy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-10-%E4%BB%A5%E5%A7%94%E6%89%98%E5%8F%96%E4%BB%A3%E5%AD%90%E7%B1%BB%EF%BC%88Replace-Subclass-with-Edlegate%EF%BC%89"><span class="toc-number">8.0.10.</span> <span class="toc-text">12.10 以委托取代子类（Replace Subclass with Edlegate）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-11-%E4%BB%A5%E5%A7%94%E6%89%98%E5%8F%96%E4%BB%A3%E8%B6%85%E7%B1%BB%EF%BC%88Replace-Suberclass-with-Delegate%EF%BC%89"><span class="toc-number">8.0.11.</span> <span class="toc-text">12.11 以委托取代超类（Replace Suberclass with Delegate）</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        读《重构》
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">liu Amon</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-11-20T13:16:50.000Z" itemprop="datePublished">2020-11-20</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E6%9F%B3%E7%B5%AE%E8%AF%97%E4%B9%A6/">柳絮诗书</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E4%BB%A3%E7%A0%81/" rel="tag">代码</a>, <a class="tag-link-link" href="/tags/%E9%87%8D%E6%9E%84/" rel="tag">重构</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>花了两次读完，6 章到 11 章读起来都想拍大腿，12 章有点水。中间有很多相互矛盾的重构方法，作者想要表示的核心在于，所有的重构方法都是有其代价的，如无必要就一定不要使用。至于什么时候是必要，这就存乎一心，全看个人总结的规则和实际的情况吧。千万不能因为懒不去进行重构，看到问题要跑步前进。里面提到了领域模型，相关的书我也必须加入书单了，还有关于 Stack 错误继承 List 的问题，这里正确的实现似乎用了设计模式里面的代理。设计模式也要好好去看看了。 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns">设计模式在这里学</a></p>
<h2 id="6章-第一组重构"><a href="#6章-第一组重构" class="headerlink" title="6章 第一组重构"></a>6章 第一组重构</h2><h4 id="6-1-提炼函数（Extract-Function）"><a href="#6-1-提炼函数（Extract-Function）" class="headerlink" title="6.1 提炼函数（Extract Function）"></a>6.1 提炼函数（Extract Function）</h4><p>反向重构：内联函数<br>能单独提取出去的操作都放到函数里<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printOwing</span>(<span class="params">invoice</span>)&#123;</span><br><span class="line">    <span class="title function_">printBanner</span>();</span><br><span class="line">    <span class="keyword">let</span> outstanding=<span class="title function_">calculateOutstanding</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//print details</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`name:<span class="subst">$&#123;invoice.customer&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`amoiunt:<span class="subst">$&#123;outstanding&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printOwing</span>(<span class="params">invoice</span>)&#123;</span><br><span class="line">    <span class="title function_">printBanner</span>();</span><br><span class="line">    <span class="keyword">let</span> outstanding=<span class="title function_">calculateOutstanding</span>();</span><br><span class="line">    <span class="title function_">printDetails</span>(outstanding);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">printDetails</span>(<span class="params">outstanding</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`name:<span class="subst">$&#123;invoice.customer&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`amoiunt:<span class="subst">$&#123;outstanding&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="6-2-内联函数（Inline-Function）"><a href="#6-2-内联函数（Inline-Function）" class="headerlink" title="6.2 内联函数（Inline Function）"></a>6.2 内联函数（Inline Function）</h4><p>反向重构：提炼函数<br>提炼的间接性能使代码更清晰可读，但是非必要的间接性会让人不舒服。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getRating</span>(<span class="params">driver</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">moreThanFiveLateDeliveries</span>(driver) ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">moreThanFiveLateDeliveries</span>(<span class="params">driver</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> driver.<span class="property">numberIdLateDeliveries</span> &gt;<span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getRating</span>(<span class="params">driver</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (driver.<span class="property">numberIdLateDeliveries</span> &gt;<span class="number">5</span>) ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="6-3提炼变量（Extract-Variable）"><a href="#6-3提炼变量（Extract-Variable）" class="headerlink" title="6.3提炼变量（Extract Variable）"></a>6.3提炼变量（Extract Variable）</h4><p>反向重构：内联变量<br>表达式可能复杂而难以阅读，局部变量能帮我们把表达式分解成容易管理的模式。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> order.<span class="property">quantity</span> * order.<span class="property">itemPrice</span> - </span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>,order.<span class="property">quantity</span> - <span class="number">500</span>) * order.<span class="property">itemPrice</span> * <span class="number">0.05</span> +</span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">min</span>(order.<span class="property">quantity</span> * order.<span class="property">itemPrice</span> * <span class="number">0.1</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure><br>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> basePrice = order.<span class="property">quantity</span> * order.<span class="property">itemPrice</span>;</span><br><span class="line"><span class="keyword">const</span> quantityDiscount = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>,,order.<span class="property">quantity</span> - <span class="number">500</span>) * order.<span class="property">itemPrice</span> * <span class="number">0.05</span>;</span><br><span class="line"><span class="keyword">const</span> shipping = <span class="title class_">Math</span>.<span class="title function_">min</span>(basePrice * <span class="number">0.1</span> ,<span class="number">100</span>)</span><br><span class="line"><span class="keyword">return</span> basePrice - quantityDiscount + shipping;</span><br></pre></td></tr></table></figure>
<h4 id="6-4-内联变量（Inline-Variable）"><a href="#6-4-内联变量（Inline-Variable）" class="headerlink" title="6.4 内联变量（Inline Variable）"></a>6.4 内联变量（Inline Variable）</h4><p>反向重构：提炼变量<br>变量是好东西，但是有时候名字并不比表达式更有表现力。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> basePrice=anOrder.<span class="property">basePrice</span>;</span><br><span class="line"><span class="keyword">return</span> (basePrice &gt; <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> anOrder.<span class="property">basePrice</span> &gt; <span class="number">1000</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="6-5-改变函数声明（Change-Function-Declaration）"><a href="#6-5-改变函数声明（Change-Function-Declaration）" class="headerlink" title="6.5 改变函数声明（Change Function Declaration）"></a>6.5 改变函数声明（Change Function Declaration）</h4><p>尽可能给函数取一个好名字，一旦发现好名字，尽快取修改。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">circum</span>(<span class="params">radius</span>) &#123; ... &#125;<span class="comment">//环</span></span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">circumference</span>(<span class="params">radius</span>) &#123; ... &#125;<span class="comment">//周长，这里周长这个名字更准确</span></span><br></pre></td></tr></table></figure></p>
<h4 id="6-6-封装变量（Encapsulate-VAriable）"><a href="#6-6-封装变量（Encapsulate-VAriable）" class="headerlink" title="6.6 封装变量（Encapsulate VAriable）"></a>6.6 封装变量（Encapsulate VAriable）</h4><p>重构中函数比数据更容易调整，因为函数只有调用，对数据的修改往往先从函数化封装所有对数据的访问开始。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> defaultOwner = &#123;<span class="attr">firstName</span>: <span class="string">&quot;Martin&quot;</span>,<span class="attr">lastName</span>: <span class="string">&quot;Fowler&quot;</span>&#125;;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> defaultOwnerData = &#123;<span class="attr">firstName</span>: <span class="string">&quot;Martin&quot;</span>,<span class="attr">lastName</span>: <span class="string">&quot;Fowler&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">defaultOwner</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> defalyOwnerData;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setDefaultOwner</span> (arg) &#123;defaultOwnerData=arg&#125;;</span><br></pre></td></tr></table></figure></p>
<h4 id="6-7-变量改名（Rename-Variable）"><a href="#6-7-变量改名（Rename-Variable）" class="headerlink" title="6.7 变量改名（Rename Variable）"></a>6.7 变量改名（Rename Variable）</h4><p>好的命名是整洁编程的核心。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = heigjt * width;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> area = height * width;</span><br></pre></td></tr></table></figure></p>
<h4 id="6-8-引入参数变量（Introduce-Parameter）"><a href="#6-8-引入参数变量（Introduce-Parameter）" class="headerlink" title="6.8 引入参数变量（Introduce Parameter）"></a>6.8 引入参数变量（Introduce Parameter）</h4><p>一组数据往往结伴同行，就是所谓数据泥团，应该代之以一个数据结构。简化参数，提升代码的一致性。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">amountInvoiced</span>(<span class="params">startDate,endData</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">amountInvoiced</span>(<span class="params">aDataRange</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="6-9-函数组合成类（Combine-Function-into-Classs）"><a href="#6-9-函数组合成类（Combine-Function-into-Classs）" class="headerlink" title="6.9 函数组合成类（Combine Function into Classs）"></a>6.9 函数组合成类（Combine Function into Classs）</h4><p>当一组函数形影不离地操作同一个数据时，就时候组建一个类了。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">base</span>(<span class="params">aReading</span>) &#123;...&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">taxableCharge</span>(<span class="params">aReading</span>)&#123;...&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calcuateBaseChange</span>(<span class="params">aReading</span>)&#123;...&#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Reading</span> &#123;</span><br><span class="line">    <span class="title function_">base</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line">    <span class="title function_">taxableCharge</span>(<span class="params"></span>)&#123;...&#125;</span><br><span class="line">    <span class="title function_">calcuateBaseCharge</span>(<span class="params"></span>)&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后7章封装，8章搬移特性，9章重新组织数据，10章简化条件逻辑，11章重构API，12章处理继承关系。读到7章就不能感同身受了，留待之后代码量更大再继续下去吧。</p>
<h2 id="7章-封装"><a href="#7章-封装" class="headerlink" title="7章 封装"></a>7章 封装</h2><h4 id="7-1-封装记录（Encapsulate-Record）"><a href="#7-1-封装记录（Encapsulate-Record）" class="headerlink" title="7.1 封装记录（Encapsulate Record）"></a>7.1 封装记录（Encapsulate Record）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">originization = &#123;<span class="attr">name</span>: <span class="string">&quot;Acme&quot;</span>, <span class="attr">country</span>: <span class="string">&quot;GB&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Origanization</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> (data)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = data.<span class="property">name</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_country</span> = data.<span class="property">country</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>;&#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">arg</span>) &#123;<span class="variable language_">this</span>.<span class="property">_name</span> = arg;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">country</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_country</span>;&#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">country</span>(<span class="params">arg</span>) &#123;<span class="variable language_">this</span>.<span class="property">_country</span> = arg;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>对于可变数据，更偏爱类对象而非记录，对象可用隐藏结构的细节，同时有助于字段的改名。<br>对不可变数据，记录也很好。</p>
<h4 id="7-2-封装集合（Encapsulate-Collection）"><a href="#7-2-封装集合（Encapsulate-Collection）" class="headerlink" title="7.2 封装集合（Encapsulate Collection）"></a>7.2 封装集合（Encapsulate Collection）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">course</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_course</span>;&#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">sourse</span>(<span class="params">aList</span>) &#123;<span class="variable language_">this</span>.<span class="property">_course</span> = aList;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">course</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_course</span>.<span class="title function_">slice</span>();&#125;</span><br><span class="line">    <span class="title function_">addCourse</span>(<span class="params">aCourse</span>) &#123; ... &#125;</span><br><span class="line">    <span class="title function_">removeCourse</span>(<span class="params">aCourse</span>) &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>只对集合变量的访问进行了封装，但让取值函数返回集合本身，这使得集合的成员变量可用直接被修改，而封装它的类全然不知，无法介入。<br>为了避免这种情况，在类上通常加入一些修改集合的方法，比如“添加”、“移除”，这样使得对集合的修改必须经过类，当程序演化变大时，依然能轻易找出修改点。</p>
<h4 id="7-3-以对象取代基本类型（Replace-Primitive-with-Object）"><a href="#7-3-以对象取代基本类型（Replace-Primitive-with-Object）" class="headerlink" title="7.3 以对象取代基本类型（Replace Primitive with Object）"></a>7.3 以对象取代基本类型（Replace Primitive with Object）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">orders.<span class="title function_">filter</span>(<span class="function"><span class="params">o</span> =&gt;</span> <span class="string">&quot;hight&quot;</span> == o.<span class="property">priority</span></span><br><span class="line">                || <span class="string">&quot;rush&quot;</span> == o.<span class="property">priority</span>);</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orders.<span class="property">filter</span> (<span class="function"><span class="params">o</span> =&gt;</span> o.<span class="property">prority</span>.<span class="title function_">higherThan</span>(<span class="keyword">new</span> <span class="title class_">Priority</span>(<span class="string">&quot;normal&quot;</span>)))</span><br></pre></td></tr></table></figure><br>尽量对基本类型使用类进行封装，因为随着代码的增加，这些封装的代价微乎其微。</p>
<h4 id="7-4-以查询取代临时变量-（Replace-Temp-with-Query）"><a href="#7-4-以查询取代临时变量-（Replace-Temp-with-Query）" class="headerlink" title="7.4 以查询取代临时变量 （Replace Temp with Query）"></a>7.4 以查询取代临时变量 （Replace Temp with Query）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> basePrice = <span class="variable language_">this</span>.<span class="property">_quantity</span> * <span class="variable language_">this</span>.<span class="property">_itemPrice</span>;</span><br><span class="line"><span class="keyword">if</span> (basePrice &gt; <span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> basePrice * <span class="number">0.95</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">return</span> basePrice * <span class="number">0.98</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title function_">basePrice</span>() &#123;<span class="variable language_">this</span>.<span class="property">_quantity</span> * <span class="variable language_">this</span>.<span class="property">_itemPrice</span>;&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">basePrice</span> &gt; <span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">basePrice</span> * <span class="number">0.95</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">basePrice</span> * <span class="number">0.98</span>;</span><br></pre></td></tr></table></figure><br>临时变量很好用，但是值得更进一步。将变量的计算逻辑放到函数中，有助于在提炼得到的函数于原函数之间建立清晰的边界。</p>
<h4 id="7-5-提炼类（Extract-Class）"><a href="#7-5-提炼类（Extract-Class）" class="headerlink" title="7.5 提炼类（Extract Class）"></a>7.5 提炼类（Extract Class）</h4><p>反向重构：内联类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeAreaCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_officeAreaCode</span>;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeNumber</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_officeNumber</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeAreaCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_telephoneNumber</span>.<span class="property">areaCode</span>;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeNumber</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_telephoneNumber</span>.<span class="property">number</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TelephoneNumber</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">areaCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_areaCode</span>;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">number</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_number</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>常听说一个类应该是一个清晰的抽象，但是实际工作中类会不断增加东西，每次添加都觉得不必单独建立一个类。如果某些数据和函数常常成对出现，这就表示需要将它们分离出去，一个有用的测试是问自己，如果移动了这些字段和函数会发生什么。<br>另一个开发后期出现的信号是类的子类化，如果你发现子类化只影响类的部分特性，或者某些特性需要以一种子类化，某些特性需要另一种子类化，就意味着你需要分解原理的类。</p>
<h4 id="7-6-内联类（Inline-Class）"><a href="#7-6-内联类（Inline-Class）" class="headerlink" title="7.6 内联类（Inline Class）"></a>7.6 内联类（Inline Class）</h4><p>反向重构：提炼类<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeAreaCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_telephoneNumber</span>.<span class="property">areaCode</span>;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeNumber</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_telephoneNumber</span>.<span class="property">number</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TelephoneNumber</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">areaCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_areaCode</span>;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">number</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_number</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeAreaCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_officeAreaCode</span>;&#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">officeNumber</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_officeNumber</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>内联类于提炼类正好相反，如果一个类不在承担足够责任，不再有单独存在的理由（通常是因为此前的重构行为移走了这个类的责任），就以本手法将“萎缩类”塞进另一个类中。</p>
<h4 id="7-7-隐藏委托关系（Hide-Delegat）"><a href="#7-7-隐藏委托关系（Hide-Delegat）" class="headerlink" title="7.7 隐藏委托关系（Hide Delegat）"></a>7.7 隐藏委托关系（Hide Delegat）</h4><p>反向重构：移除中间人</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager = aPerson.<span class="property">department</span>.<span class="property">manager</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">manager = aPerson.<span class="property">manager</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">manager</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">department</span>.<span class="property">manager</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>随着经验日渐丰富，你会发现，有很多值得封装的东西。<br>将委托关系隐藏起来，除去依赖，将来委托关系发生变化时，也只会影响服务对象，而不会直接波及所有客户端。</p>
<h4 id="7-8-移除中间人（Remove-Middle-Man）"><a href="#7-8-移除中间人（Remove-Middle-Man）" class="headerlink" title="7.8 移除中间人（Remove Middle Man）"></a>7.8 移除中间人（Remove Middle Man）</h4><p>反向重构：隐藏委托关系<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">manager = aPerson.<span class="property">manager</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">manager</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">department</span>.<span class="property">manager</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager = aPerson.<span class="property">department</span>.<span class="property">manager</span>;</span><br></pre></td></tr></table></figure><br>封装是有代价，随着受委托的特性或功能越来越多，更多的转发函数让人烦躁，此时应该让客户直接调用受委托类。相关内容：<strong>迪米特法则</strong>。</p>
<h4 id="7-9-替换算法（Subtitute-Algorithm）"><a href="#7-9-替换算法（Subtitute-Algorithm）" class="headerlink" title="7.9 替换算法（Subtitute Algorithm）"></a>7.9 替换算法（Subtitute Algorithm）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foundPerson</span>(<span class="params">people</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; people.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (people[i] == <span class="string">&quot;Don&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Don&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (people[i] == <span class="string">&quot;John&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;John&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (people[i] == <span class="string">&quot;Kent&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Kent&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foundPerson</span>(<span class="params">people</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> candidate = [<span class="string">&quot;Don&quot;</span>,<span class="string">&quot;John&quot;</span>,<span class="string">&quot;Kent&quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> people.<span class="title function_">find</span>(<span class="function"><span class="params">p</span> =&gt;</span> candidate.<span class="title function_">includes</span>(p)) || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>有时候必须壮士断腕，删除整个算法，代之以简单的算法。随着对问题的理解加深，往往发现更简单的解决办法。</p>
<h2 id="8章-搬移特性"><a href="#8章-搬移特性" class="headerlink" title="8章 搬移特性"></a>8章 搬移特性</h2><p>在不同的上下文中间搬移元素。</p>
<h4 id="8-1-搬移函数"><a href="#8-1-搬移函数" class="headerlink" title="8.1 搬移函数"></a>8.1 搬移函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">overdraftCharge</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AccountType</span>&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">overdraftCharge</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>设计出高度模块化的程序，需要保证互相管理的软件要素集中到一块，并保证块与块之间的联系易于查找、直观易懂。同时对模型的设计不能一成不变，随着对代码理解的加深，我们要将这种理解反应到代码上，就得不断搬移这些元素。</p>
<h4 id="8-2-搬移字段（Move-Field）"><a href="#8-2-搬移字段（Move-Field）" class="headerlink" title="8.2 搬移字段（Move Field）"></a>8.2 搬移字段（Move Field）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">plan</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_plan</span>;&#125;</span><br><span class="line">    get discountRate () &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_discountRate</span>；&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">plan</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_plan</span>;  &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">discountRate</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">plan</span>.<span class="property">discountRate</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要了解一些<strong>领域驱动</strong>的知识，才能更好地设计数据结构。如果发现数据结构不再适用时，就应该立刻修改。</p>
<p>总是一同出现、一同作为函数参数传递的数据，最好是规整到同一条记录中。</p>
<h4 id="8-3-搬移语句到函数（Move-Statements-into-Function）"><a href="#8-3-搬移语句到函数（Move-Statements-into-Function）" class="headerlink" title="8.3 搬移语句到函数（Move Statements into Function）"></a>8.3 搬移语句到函数（Move Statements into Function）</h4><p>反向重构：搬移语句到调用者 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">result.<span class="title function_">push</span>(<span class="string">`&lt;p&gt;title: <span class="subst">$&#123;person.photo.title&#125;</span>&lt;/p&gt;&#x27;);</span></span><br><span class="line"><span class="string">result.concat(photoData(person.photo));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function photoData(aPhoto)&#123;</span></span><br><span class="line"><span class="string">    return [</span></span><br><span class="line"><span class="string">        `</span>&lt;p&gt;<span class="attr">location</span>: $&#123;aPhoto.<span class="property">location</span>&#125;&lt;/p&gt;<span class="string">`,</span></span><br><span class="line"><span class="string">        `</span>&lt;p&gt;<span class="attr">data</span>: $&#123;aPhoto.<span class="property">date</span>.<span class="title function_">toDateString</span>()&#125;&lt;/p&gt;<span class="string">`,</span></span><br><span class="line"><span class="string">    ];</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">result.<span class="title function_">concat</span>(<span class="title function_">photoData</span>(person.<span class="property">photo</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">photoData</span>(<span class="params">aPhoto</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">`&lt;p&gt;title: <span class="subst">$&#123;aPhoto.title&#125;</span>&lt;/p&gt;`</span>,</span><br><span class="line">        <span class="string">`&lt;p&gt;location: <span class="subst">$&#123;aPhoto.location&#125;</span>&lt;/p&gt;`</span>,</span><br><span class="line">        <span class="string">`&lt;p&gt;data: <span class="subst">$&#123;aPhoto.date.toDateString()&#125;</span>&lt;/p&gt;`</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>代码健康最重要的黄金法则就算“消除重复”，如果发现调用某个函数时，总有一些相同的代码也需要执行那就考虑将这段代码合并到函数里头。</p>
<h4 id="8-4-搬移语句到调用者（Move-Statements-to-Callers）"><a href="#8-4-搬移语句到调用者（Move-Statements-to-Callers）" class="headerlink" title="8.4 搬移语句到调用者（Move Statements to Callers）"></a>8.4 搬移语句到调用者（Move Statements to Callers）</h4><p>反向重构：搬移语句到函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">emitPhotoData</span>(outStream, person.<span class="property">photo</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emitPhotoData</span>(<span class="params">outStream, photo</span>)&#123;</span><br><span class="line">    outStream.<span class="title function_">write</span>(<span class="string">`&lt;p&gt;title: <span class="subst">$&#123;photo.title&#125;</span>&lt;/p&gt;\n`</span>);</span><br><span class="line">    outStream.<span class="title function_">write</span>(<span class="string">`&lt;p&gt;location: <span class="subst">$&#123;photo.location&#125;</span>&lt;/p&gt;\n`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">emitPhotoData</span>(outStream, person.<span class="property">photo</span>);</span><br><span class="line">outStream.<span class="title function_">write</span>(<span class="string">`&lt;p&gt;location: <span class="subst">$&#123;person.photo.location&#125;</span>&lt;/p&gt;\n`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emitPhotoData</span>(<span class="params">outStream, photo</span>)&#123;</span><br><span class="line">    outStream.<span class="title function_">write</span>(<span class="string">`&lt;p&gt;title: <span class="subst">$&#123;photo.title&#125;</span>&lt;/p&gt;\n`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>随着系统能力发生演化，函数的抽象边界总会悄悄发生偏移，函数边界发生偏移的一个征兆是，以往在多个地方共用的行为，如今需要在某些调用点面前表现出不同的行为。</p>
<p>于是我们把表现不同的行为从函数中挪出来，并搬移到器调用处。</p>
<h4 id="8-5-以函数调用取代内联代码（Replace-Inline-Code-with-Function-Call）"><a href="#8-5-以函数调用取代内联代码（Replace-Inline-Code-with-Function-Call）" class="headerlink" title="8.5 以函数调用取代内联代码（Replace Inline Code with Function Call）"></a>8.5 以函数调用取代内联代码（Replace Inline Code with Function Call）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> appliesToMass = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> s <span class="keyword">of</span> states)&#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="string">&quot;MA&quot;</span>) appliesToMass = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appliesToMass = states.<span class="title function_">includes</span>(<span class="string">&quot;MA&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>善用代码将相关行为打包，并给出一个良好的命名，能避免重复。</p>
<h4 id="8-6-移动语句（Slide-Statements）"><a href="#8-6-移动语句（Slide-Statements）" class="headerlink" title="8.6 移动语句（Slide Statements）"></a>8.6 移动语句（Slide Statements）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pricingPlan = <span class="title function_">retrievePricingPlan</span>();</span><br><span class="line"><span class="keyword">const</span> order = <span class="title function_">retreOrder</span>();</span><br><span class="line"><span class="keyword">let</span> charge;</span><br><span class="line"><span class="keyword">const</span> charPerUnit = pricingPlan.<span class="property">unit</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pricingPlan = <span class="title function_">retrievePricingPlan</span>();</span><br><span class="line"><span class="keyword">const</span> chargePerUnit = pricingPlan.<span class="property">unit</span>;</span><br><span class="line"><span class="keyword">const</span> order = <span class="title function_">retreiveOrder</span>();</span><br><span class="line"><span class="keyword">let</span> charge;</span><br></pre></td></tr></table></figure><br>让存在管理的东西一起出现，可以使代码更容易理解。如果有几行代码取用了同一个数据结构，最好让它们一起出现。</p>
<h4 id="8-7-拆分循环（Split-Loop）"><a href="#8-7-拆分循环（Split-Loop）" class="headerlink" title="8.7 拆分循环（Split Loop）"></a>8.7 拆分循环（Split Loop）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> averageAge = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> totalSalary = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> people)&#123;</span><br><span class="line">    averageAge += p.<span class="property">age</span>;</span><br><span class="line">    totalSalary += p.<span class="property">salary</span>;</span><br><span class="line">&#125;</span><br><span class="line">averageAge = averageAge / people.<span class="property">length</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> totalSalary = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> people)&#123;</span><br><span class="line">    totalSalary += p.<span class="property">salary</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> averageAge = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> people)&#123;</span><br><span class="line">    averageAge +=p.<span class="property">age</span>;</span><br><span class="line">&#125;</span><br><span class="line">averageAge = averageAge / people.<span class="property">length</span>;</span><br></pre></td></tr></table></figure><br>拆分循环，一个循环只干一个事。这里为了后续的修改，时间复杂度的代价是值得付出的。</p>
<h4 id="8-8-以管道取代循环（Replace-Loop-with-Pipeline）"><a href="#8-8-以管道取代循环（Replace-Loop-with-Pipeline）" class="headerlink" title="8.8 以管道取代循环（Replace Loop with Pipeline）"></a>8.8 以管道取代循环（Replace Loop with Pipeline）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> input)&#123;</span><br><span class="line">    <span class="keyword">if</span> (i.<span class="property">job</span> === <span class="string">&quot;programmer&quot;</span>)</span><br><span class="line">    names.<span class="title function_">push</span>(i.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> names = input</span><br><span class="line">    .<span class="title function_">filter</span>(<span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">job</span> === <span class="string">&quot;program&quot;</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">name</span>)</span><br><span class="line">    ;</span><br></pre></td></tr></table></figure><br>一些逻辑如果采用集合管道来编写，代码的可读性会更强。</p>
<h4 id="8-9-移除死代码（Remove-Dead-Code）"><a href="#8-9-移除死代码（Remove-Dead-Code）" class="headerlink" title="8.9 移除死代码（Remove Dead Code）"></a>8.9 移除死代码（Remove Dead Code）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>)&#123;</span><br><span class="line">    <span class="title function_">doSomethingThatUsedToMatter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><br>无用的代码会带来很多思维上的负担，一旦代码不再适用，就该立即删除。</p>
<h2 id="9章-重新组织数据"><a href="#9章-重新组织数据" class="headerlink" title="9章 重新组织数据"></a>9章 重新组织数据</h2><h4 id="9-1-拆分变量（Split-Variable）"><a href="#9-1-拆分变量（Split-Variable）" class="headerlink" title="9.1 拆分变量（Split Variable）"></a>9.1 拆分变量（Split Variable）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> temp = <span class="number">2</span> * (height + width);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(temp);</span><br><span class="line">temp = height * width;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(temp);</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> perimeter = <span class="number">2</span> * (height + width);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(perimeter);</span><br><span class="line"><span class="keyword">const</span> area = height * width;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(area);</span><br></pre></td></tr></table></figure><br>不要给临时变量多次赋值，保证每个变量都应该只有一个责任，并且最好命名准确。</p>
<h4 id="9-2-字段改名（Rename-Field）"><a href="#9-2-字段改名（Rename-Field）" class="headerlink" title="9.2 字段改名（Rename Field）"></a>9.2 字段改名（Rename Field）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Organization</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Organization</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">title</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>命名特别重要</p>
<h4 id="9-3-以查询取代派生变量（Replace-Derived-Variable-with-Query）"><a href="#9-3-以查询取代派生变量（Replace-Derived-Variable-with-Query）" class="headerlink" title="9.3 以查询取代派生变量（Replace Derived Variable with Query）"></a>9.3 以查询取代派生变量（Replace Derived Variable with Query）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title function_">discountedTotal</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_discountedTotal</span>;&#125;</span><br><span class="line"><span class="keyword">set</span> <span class="title function_">discount</span>(<span class="params">aNumber</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> old = <span class="variable language_">this</span>.<span class="property">_discount</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">discount</span> = aNumber;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_discountedTotal</span> +=old - aNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title function_">discountedTotal</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_baseTotal</span> - <span class="variable language_">this</span>.<span class="property">_discount</span>;&#125;</span><br><span class="line"><span class="keyword">set</span> <span class="title function_">discount</span>(<span class="params">aNumber</span>) &#123;<span class="variable language_">this</span>.<span class="property">_discount</span> = aNumber;&#125;</span><br></pre></td></tr></table></figure><br>可变数据是软件中最大的错误源头之一，在一处修改数据，却在另一处造成难以发现的破坏，强烈建议尽量把可变数据的作用域限制在最小范围。</p>
<h4 id="9-4-将引用对象改为值对象（Change-Reference-to-Value）"><a href="#9-4-将引用对象改为值对象（Change-Reference-to-Value）" class="headerlink" title="9.4 将引用对象改为值对象（Change Reference to Value）"></a>9.4 将引用对象改为值对象（Change Reference to Value）</h4><p>反向重构：将值对象改为引用对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="title function_">applyDiscount</span>(<span class="params">arg</span>) &#123;<span class="variable language_">this</span>.<span class="property">_price</span>.<span class="property">amout</span> -= arg;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="title function_">appliyDiscount</span>(<span class="params">arg</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_price</span> = <span class="keyword">new</span> <span class="title class_">Money</span> (<span class="variable language_">this</span>.<span class="property">_price</span>.<span class="property">amount</span> - arg, <span class="variable language_">this</span>.<span class="property">_price</span>.<span class="property">currency</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>值对象相对来说是不可变的，可以放心把数据传给其他部分，而不用担心包装的数据被偷偷修改。</p>
<h4 id="9-5-将值对象改为引用对象（Change-Value-to-Reference）"><a href="#9-5-将值对象改为引用对象（Change-Value-to-Reference）" class="headerlink" title="9.5 将值对象改为引用对象（Change Value to Reference）"></a>9.5 将值对象改为引用对象（Change Value to Reference）</h4><p>反向重构：将引用对象改为值对象<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> customer = <span class="keyword">new</span> <span class="title class_">Customer</span>(customerData);</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> customer = customerRepository.<span class="title function_">get</span>(customerData.<span class="property">id</span>);</span><br></pre></td></tr></table></figure><br>如果共享的数据需要更新，就推荐适用引用对象。对于一个客观主体，只有一个代表它的对象。例如一个客户的数据，本身需要常常更新，这里使用应用对象，让数据的变化在各个函数之间共享会更好。</p>
<h2 id="10章-简化条件逻辑"><a href="#10章-简化条件逻辑" class="headerlink" title="10章 简化条件逻辑"></a>10章 简化条件逻辑</h2><h4 id="10-1-分解条件表达式（Decompose-Conditional）"><a href="#10-1-分解条件表达式（Decompose-Conditional）" class="headerlink" title="10.1 分解条件表达式（Decompose Conditional）"></a>10.1 分解条件表达式（Decompose Conditional）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!aDate.<span class="title function_">isBefore</span>(plan.<span class="property">summerStart</span>) &amp;&amp; !aDate.<span class="title function_">isAfter</span>(plan.<span class="property">summerEnd</span>))</span><br><span class="line">    charge = quantity * plan.<span class="property">summerRate</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    charge = quantity * plan.<span class="property">regularRate</span> + plan.<span class="property">regularServiceCharge</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_">summer</span>())</span><br><span class="line">    charge = <span class="title function_">sumnerCharge</span>();</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    charge = <span class="title function_">regularCharge</span>();</span><br></pre></td></tr></table></figure><br>将大块头代码分解未多个独立的函数，并根据其用途，为分解得到的新函数命名。</p>
<h4 id="10-2-合并条件表达式（Consilidate-Conditional-Expression）"><a href="#10-2-合并条件表达式（Consilidate-Conditional-Expression）" class="headerlink" title="10.2 合并条件表达式（Consilidate Conditional Expression）"></a>10.2 合并条件表达式（Consilidate Conditional Expression）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (anEmployee.<span class="property">seniority</span> &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (anEmployee.<span class="property">monthsDisabled</span> &gt; <span class="number">12</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (anEmployee.<span class="property">isPartTime</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_">isNotEligibleForDisability</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">isNotEligibleForDisability</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> ((anEmployee.<span class="property">seniority</span> &lt; <span class="number">2</span>)</span><br><span class="line">            || (anEmployee.<span class="property">monthsDisabled</span> &gt; <span class="number">12</span>)</span><br><span class="line">            || (anEmployee.<span class="property">isPartTime</span>));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>有时候发现一连串的检查条件最终行为一致，就应该用“逻辑与”和“逻辑或”将它们合并成一个添加表达式。</p>
<h4 id="10-3-以卫语句取代嵌套添加表达式（Replace-Nested-Conditional-with-Guard-Clauses）"><a href="#10-3-以卫语句取代嵌套添加表达式（Replace-Nested-Conditional-with-Guard-Clauses）" class="headerlink" title="10.3 以卫语句取代嵌套添加表达式（Replace Nested Conditional with Guard Clauses）"></a>10.3 以卫语句取代嵌套添加表达式（Replace Nested Conditional with Guard Clauses）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPayAmount</span> () &#123;</span><br><span class="line">    <span class="keyword">let</span> result;</span><br><span class="line">    <span class="keyword">if</span> (isDead)</span><br><span class="line">        result = <span class="title function_">deadAmount</span>();</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isSeparated)</span><br><span class="line">            result = <span class="title function_">separatedAmount</span>();</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (isRetired)</span><br><span class="line">                result = <span class="title function_">retiredAmount</span>();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                result = <span class="title function_">normalPayment</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPayment</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> (isDead) <span class="keyword">return</span> <span class="title function_">deadAmount</span>();</span><br><span class="line">    <span class="keyword">if</span> (isSeparated)  <span class="keyword">return</span> <span class="title function_">separatedAmount</span>();</span><br><span class="line">    <span class="keyword">if</span> (isRetired) <span class="keyword">return</span> <span class="title function_">retiredAmount</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">noramlPayAmount</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>如果某个条件极其罕见，就应该单独检查该条件，并在该条件为真时立即从函数中返回，这样的单独检查称为“卫语句”（guard clauses）。函数入口处判断边界条件时常用到。</p>
<h4 id="10-4-以多态取代条件表达式（Replace-Conditional-with-Polymorphism）"><a href="#10-4-以多态取代条件表达式（Replace-Conditional-with-Polymorphism）" class="headerlink" title="10.4 以多态取代条件表达式（Replace Conditional with Polymorphism）"></a>10.4 以多态取代条件表达式（Replace Conditional with Polymorphism）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (bird.<span class="property">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;EuropeanSwallow&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;average&quot;</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;AfricanSwallow&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> (bird.<span class="property">numberOfCoconuts</span> &gt; <span class="number">2</span>) ? <span class="string">&quot;tired&quot;</span> : <span class="string">&quot;average&quot;</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;NorwegianBlueParrot&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> (bird.<span class="property">voltage</span> &gt; <span class="number">100</span>) ? <span class="string">&quot;scorched&quot;</span> : <span class="string">&quot;beautiful&quot;</span>;</span><br><span class="line"><span class="attr">default</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EuropeanSwallow</span> &#123;</span><br><span class="line">    get plumage () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;average&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AfricanSwallow</span> &#123;</span><br><span class="line">    get plumage () &#123;</span><br><span class="line">        (bird.<span class="property">numberOfCoconuts</span> &gt; <span class="number">2</span>) ? <span class="string">&quot;tired&quot;</span> : <span class="string">&quot;average&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NorwegianBlueParrot</span> &#123;</span><br><span class="line">    get plumage () &#123;</span><br><span class="line">       <span class="keyword">return</span> (bird.<span class="property">voltage</span> &gt; <span class="number">100</span>) ? <span class="string">&quot;scorched&quot;</span> : <span class="string">&quot;beautiful&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>当出现好几个函数都有基于类型代码的 switch 语句的征兆出现，就可以针对 switch 中的每种分支逻辑创建一个类，用多态来继承各个类型特有的行为，从而去除重复的分支逻辑。</p>
<h4 id="10-5-引入特例（Introduce-Special-Case）"><a href="#10-5-引入特例（Introduce-Special-Case）" class="headerlink" title="10.5 引入特例（Introduce Special Case）"></a>10.5 引入特例（Introduce Special Case）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (aCustomer === <span class="string">&quot;unknown&quot;</span>) customerName = <span class="string">&quot;occupant&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UnknownCustomer</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123;<span class="keyword">return</span> <span class="string">&quot;occupant&quot;</span>;&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>一种常见的重复是一个数据结构的使用者都在在检查某个特殊的值，并且这个特殊值出现时所作的处理都相同。就可以使用特例模式。<br>创建一个特例元素，用以表达这个中特例的共用行为的处理。一个常见的特例处理值就算 null。</p>
<h4 id="10-6-引入断言（Introduce-Assertion）"><a href="#10-6-引入断言（Introduce-Assertion）" class="headerlink" title="10.6 引入断言（Introduce Assertion）"></a>10.6 引入断言（Introduce Assertion）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">discountRate</span>)</span><br><span class="line">    base = base - (<span class="variable language_">this</span>.<span class="property">discountRate</span> * base)</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assert (<span class="variable language_">this</span>.<span class="property">discountRate</span> &gt;= <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">discountRate</span>)</span><br><span class="line">    base = base - (<span class="variable language_">this</span>.<span class="property">discountRate</span> * base)</span><br></pre></td></tr></table></figure><br>常常有只有当某个条件为真时才能正常运行的代码。这样的假设并没有在代码中明确表现。必须阅读整个算法才能看出来，有事程序员会用注释写出这种假设，但是使用断言更好。</p>
<h2 id="11章-重构-API"><a href="#11章-重构-API" class="headerlink" title="11章 重构 API"></a>11章 重构 API</h2><p>模块和函数是软件的骨肉，而 API 则是关节。</p>
<h4 id="11-1-将查询函数和修改函数分离（Separate-Query-from-Modifier）"><a href="#11-1-将查询函数和修改函数分离（Separate-Query-from-Modifier）" class="headerlink" title="11.1 将查询函数和修改函数分离（Separate Query from Modifier）"></a>11.1 将查询函数和修改函数分离（Separate Query from Modifier）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getTotalOutstandingAndSendBill</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = customer.<span class="property">invoices</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, each</span>) =&gt;</span> each.<span class="property">amount</span> + total ,<span class="number">0</span>);</span><br><span class="line">    <span class="title function_">sendBill</span>();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">totalOutstanding</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> customer.<span class="property">invoices</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, sach</span>) =&gt;</span> each.<span class="property">amount</span> + total, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendBill</span>(<span class="params"></span>) &#123;</span><br><span class="line">    emailGateway.<span class="title function_">send</span>(<span class="title function_">fromatBill</span>(customer));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>函数分为“有副作用”和“无副作用”，任何有返回值的函数都不应该有看得到的副作用。命令与查询分开（Command-Query Separation）[mf-cqs]。这个一条必须遵守的规则，它会回报很好的效果。</p>
<h4 id="11-2-函数参数化（Parameterize-Function）"><a href="#11-2-函数参数化（Parameterize-Function）" class="headerlink" title="11.2 函数参数化（Parameterize Function）"></a>11.2 函数参数化（Parameterize Function）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tenPercentRaise</span>(<span class="params">aPerson</span>) &#123;</span><br><span class="line">    aPerson.<span class="property">salary</span> = aPerson.<span class="property">salary</span>.<span class="title function_">mutiply</span>(<span class="number">1.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fivePercentRaise</span>(<span class="params">aPerson</span>) &#123;</span><br><span class="line">    aPerson.<span class="property">salary</span> = aPerson.<span class="property">salary</span>.<span class="title function_">mutiply</span>(<span class="number">1.05</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">raise</span>(<span class="params">aPerson, factor</span>) &#123;</span><br><span class="line">    aPerson.<span class="property">salary</span> = aPerson.<span class="property">salary</span>.<span class="title function_">mutiply</span>(<span class="number">1</span>+factor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>如果两个函数逻辑非常相似，只有一些字面值不同，可以将其合并成一个函数。</p>
<h4 id="11-3-移除标记参数（Remove-Flag-Argument）"><a href="#11-3-移除标记参数（Remove-Flag-Argument）" class="headerlink" title="11.3 移除标记参数（Remove Flag Argument）"></a>11.3 移除标记参数（Remove Flag Argument）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setDimension</span>(<span class="params">name, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&quot;hight&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_height</span> = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&quot;width&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_width</span> =value;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setHight</span>(<span class="params">value</span>) &#123;<span class="variable language_">this</span>.<span class="property">_height</span> = value&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setWidth</span>(<span class="params">value</span>) &#123;<span class="variable language_">this</span>.<span class="property">_width</span> = value&#125;</span><br></pre></td></tr></table></figure><br>移除标记参数不仅能使代码更整洁，而且能帮助开发工具更好地发挥作用。</p>
<h4 id="11-4-保持对象完整（Preseve-Whole-Object）"><a href="#11-4-保持对象完整（Preseve-Whole-Object）" class="headerlink" title="11.4 保持对象完整（Preseve Whole Object）"></a>11.4 保持对象完整（Preseve Whole Object）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> low = aRoom.<span class="property">daysTempRange</span>.<span class="property">low</span>;</span><br><span class="line"><span class="keyword">const</span> high = aRoom.<span class="property">daysRempRange</span>.<span class="property">high</span>;</span><br><span class="line"><span class="keyword">if</span> (aPlan.<span class="title function_">withinRange</span>(low, high))</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (aPlan.<span class="title function_">withinRange</span>(aRoom.<span class="property">daysTempRange</span>))</span><br></pre></td></tr></table></figure><br>如果看到代码从一个记录结构中导出几个值，然后又一起传递到另一个函数中，更好是把整个记录传给函数，在函数体内部导出所需要的值。这样能更好地应对变化。</p>
<h4 id="11-5-以查询取代参数（Replace-Parameter-with-Query）"><a href="#11-5-以查询取代参数（Replace-Parameter-with-Query）" class="headerlink" title="11.5 以查询取代参数（Replace Parameter with Query）"></a>11.5 以查询取代参数（Replace Parameter with Query）</h4><p>反向重构：以参数取代查询<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">availbeVacation (anEmployee, anEmployee.<span class="property">grade</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">availableVacation</span>(<span class="params">anEmployee, grade</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">availableVacation</span>(anEmployee)P&#123;</span><br><span class="line">    <span class="keyword">const</span> grade = anEmployee.<span class="property">grade</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>参数列表应该尽量避免重复，参数越少越好。</p>
<h4 id="11-6-以参数取代查询（Replace-Query-with-Parameter）"><a href="#11-6-以参数取代查询（Replace-Query-with-Parameter）" class="headerlink" title="11.6 以参数取代查询（Replace Query with Parameter）"></a>11.6 以参数取代查询（Replace Query with Parameter）</h4><p>反向重构：以查询取代参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">targetTemperature</span>(aPlan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">targetTemperature</span>(<span class="params">aPlan</span>)&#123;</span><br><span class="line">    currentTemperature = thermostat.<span class="property">currentTemperature</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">targetTemperature</span>(aPlan, thermost.<span class="property">currentTemperature</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">targetTemperature</span>(<span class="params">aPlan, currentTemperature</span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>有时候会出现一些不愉快的引用关系，为了让函数不依赖于某个元素，就把这个元素的值以参数的形式传递给该函数。除此之外，应该尽量减短参数数目。</p>
<h4 id="11-7-移除设值函数（Remove-Setting-Method）"><a href="#11-7-移除设值函数（Remove-Setting-Method）" class="headerlink" title="11.7 移除设值函数（Remove Setting Method）"></a>11.7 移除设值函数（Remove Setting Method）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>如果不希望再对象创建之后字段还有机会被改变，就不要为它提供设值函数。</p>
<h4 id="11-8-以工厂函数取代构造函数（Replace-Constructor-with-Factory-Function）"><a href="#11-8-以工厂函数取代构造函数（Replace-Constructor-with-Factory-Function）" class="headerlink" title="11.8 以工厂函数取代构造函数（Replace Constructor with Factory Function）"></a>11.8 以工厂函数取代构造函数（Replace Constructor with Factory Function）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leadEngineer = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="variable language_">document</span>.<span class="property">leadEngineer</span>, <span class="string">&#x27;E&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leadEngineer = <span class="title function_">createEngineer</span>(<span class="variable language_">document</span>.<span class="property">leadEngineer</span>);</span><br></pre></td></tr></table></figure><br>使用工厂模式。</p>
<h4 id="11-9-以命令取代函数（Replace-Function-with-Command）"><a href="#11-9-以命令取代函数（Replace-Function-with-Command）" class="headerlink" title="11.9 以命令取代函数（Replace Function with Command）"></a>11.9 以命令取代函数（Replace Function with Command）</h4><p>反向重构：以函数取代命令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">socre</span>(<span class="params">candidate, medicalExam, scoreingGuide</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> healthLevel = <span class="number">0</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Scorer</span> &#123;</span><br><span class="line">    <span class="title function_">constructot</span>(<span class="params">candidate, medicalExam, socringGuide</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_candidate</span> = candidate;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_medicalExam</span> = medicalExam;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_socringGuide</span> = socringGuide;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="title function_">execute</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_result</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_healthLevel</span> = <span class="number">0</span>;</span><br><span class="line">    ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>将函数封装成自己的对象，有时候也有用。命令对象提供了更大的控制灵活性和更强的表达能力。可以轻松将复杂函数拆解成多个方法，彼此之间通过字段共享状态，拆解后的方法可以分别调用，开始调用前的数据状态也可以逐步构建。</p>
<h4 id="11-10-以函数取代命令（Replace-Command-with-Function）"><a href="#11-10-以函数取代命令（Replace-Command-with-Function）" class="headerlink" title="11.10 以函数取代命令（Replace Command with Function）"></a>11.10 以函数取代命令（Replace Command with Function）</h4><p>反向重构： 以命令取代函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ChargeCalculator</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> (customer, usage)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_customer</span> = customer;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_usage</span> = usage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">execute</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_customer</span>.<span class="property">rate</span> * <span class="variable language_">this</span>.<span class="property">_usage</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">charge</span>(<span class="params">customer, usage</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> customer.<span class="property">rate</span> * usage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>命令对象的强大是有代价的，大多数时候没有必要使用。</p>
<h2 id="12章-处理继承关系"><a href="#12章-处理继承关系" class="headerlink" title="12章 处理继承关系"></a>12章 处理继承关系</h2><h4 id="12-1-函数上移（Pull-Up-Method）"><a href="#12-1-函数上移（Pull-Up-Method）" class="headerlink" title="12.1 函数上移（Pull Up Method）"></a>12.1 函数上移（Pull Up Method）</h4><p>反向重构：函数下移<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Salesman</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span>&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Engineer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span>&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Salesman</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Engineer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>重复代码是 bug 的温床。</p>
<h4 id="12-2-字段上移（Pull-Up-Field）"><a href="#12-2-字段上移（Pull-Up-Field）" class="headerlink" title="12.2 字段上移（Pull Up Field）"></a>12.2 字段上移（Pull Up Field）</h4><p>反向重构：字段下移</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Salesman</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123;</span><br><span class="line">    priavte <span class="title class_">String</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Engineer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123;</span><br><span class="line">    private <span class="title class_">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    private <span class="title class_">String</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Salesman</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Engineer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-3-构造函数本体上移（Pull-Up-Constructor-Body）"><a href="#12-3-构造函数本体上移（Pull-Up-Constructor-Body）" class="headerlink" title="12.3 构造函数本体上移（Pull Up Constructor Body）"></a>12.3 构造函数本体上移（Pull Up Constructor Body）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Party</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Party</span> &#123;</span><br><span class="line">    <span class="title function_">sonstructor</span>(<span class="params">name, id, monthyCost</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_id</span> = id;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_monthyCost</span> = monthyCost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Party</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = name;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empolyee</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Party</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, id, monthlyCost</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_id</span> = id;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_monthyCost</span> = monthlyCost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>各个子类中有共同行为，第一念头是将其提炼到同一个函数中，并将其上移。构造函数是一种特殊情况，因为其有特殊规则。如果重构过于复杂，就考虑使用工厂模式。</p>
<h4 id="12-4-函数下移（Push-Down-Method）"><a href="#12-4-函数下移（Push-Down-Method）" class="headerlink" title="12.4 函数下移（Push Down Method）"></a>12.4 函数下移（Push Down Method）</h4><p>反向重构：函数上移</p>
<p>如果超类中某个函数只与一个或少数几个子类相关，最好将其下移。如果超类不知道具体哪些子类需要这个函数时，使用多态取代条件表达式。</p>
<h4 id="12-5-字段下移（Push-Down-Field）"><a href="#12-5-字段下移（Push-Down-Field）" class="headerlink" title="12.5 字段下移（Push Down Field）"></a>12.5 字段下移（Push Down Field）</h4><p>反向重构：字段上移</p>
<h4 id="12-6-以子类取代类型码（Replace-Type-Code-with-Subclasses）"><a href="#12-6-以子类取代类型码（Replace-Type-Code-with-Subclasses）" class="headerlink" title="12.6 以子类取代类型码（Replace Type Code with Subclasses）"></a>12.6 以子类取代类型码（Replace Type Code with Subclasses）</h4><p>反向重构：移除子类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createEmployee</span>(<span class="params">name, type</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(name, type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createEmployee</span>(<span class="params">name, type</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;engineer&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Enginner</span>(name);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;salesman&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Salesman</span>(name);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;manager&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Manager</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大多数时候，有类型码就够了，但是进一步引入子类有两个好处:</p>
<ol>
<li>可以使用多态来处理相似但不同的逻辑。</li>
<li>有些字段或函数对特定的类型码才有意义，比如”销售目标“只对销售员工有效。使用类型码需要加入逻辑验证，有了子类能更明确表达这些信息。</li>
</ol>
<h4 id="12-7-移除子类（Remove-Subclass）"><a href="#12-7-移除子类（Remove-Subclass）" class="headerlink" title="12.7 移除子类（Remove Subclass）"></a>12.7 移除子类（Remove Subclass）</h4><p>反向重构：以子类取代类型码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">genderCode</span>() &#123;<span class="keyword">return</span> <span class="string">&quot;X&quot;</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Male</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">genderCode</span>() &#123;<span class="keyword">return</span> <span class="string">&quot;M&quot;</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Female</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">genderCode</span>() &#123;<span class="keyword">return</span> <span class="string">&quot;F&quot;</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">genderCode</span>() &#123;<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_genderCode</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>子类存在成本，如果用不上就别用。</p>
<h4 id="12-8-提炼超类（Extract-Superclass）"><a href="#12-8-提炼超类（Extract-Superclass）" class="headerlink" title="12.8 提炼超类（Extract Superclass）"></a>12.8 提炼超类（Extract Superclass）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">totalAnnualCost</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">headCount</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">annualCost</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">id</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Party</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">annualCost</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Party</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">annualCost</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">headCount</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Party</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">annualCost</span>() &#123; ... &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">id</span>() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果发现两个类在做相似的事，就把它们的相似之处提炼到超类。</p>
<h4 id="12-9-折叠继承体系（Collapse-Hierarchy）"><a href="#12-9-折叠继承体系（Collapse-Hierarchy）" class="headerlink" title="12.9 折叠继承体系（Collapse Hierarchy）"></a>12.9 折叠继承体系（Collapse Hierarchy）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Salesman</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>有时发现一个类与其超类区别不大时，把超类子类合并。</p>
<h4 id="12-10-以委托取代子类（Replace-Subclass-with-Edlegate）"><a href="#12-10-以委托取代子类（Replace-Subclass-with-Edlegate）" class="headerlink" title="12.10 以委托取代子类（Replace Subclass with Edlegate）"></a>12.10 以委托取代子类（Replace Subclass with Edlegate）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">daysToShip</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_warehouse</span>.<span class="property">daysToShip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PriorityOrder</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Order</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">daysToShip</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_priorityPlan</span>.<span class="property">daysToShip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">daysToShip</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">this</span>.<span class="property">_priorityDelegate</span>)</span><br><span class="line">                ? <span class="variable language_">this</span>.<span class="property">_priorityDelegate</span>.<span class="property">daysToShip</span></span><br><span class="line">                : <span class="variable language_">this</span>.<span class="property">_warehouse</span>.<span class="property">daysToShip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PriorityOrder</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">daysToShip</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_priorityPlan</span>.<span class="property">daysToShip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>虽然继承很好用，但继承根类之间引入了非常紧密的关系，而继承牌只能打一次。<br>由于导致行为不同的原因有多种，但继承只能处理一个方向上的变化。比如人可以按年龄分为两类，或者财富分为两类。继承只能使用一次，不能同时采用两种方式继承。</p>
<p>这两个问题用委托都能解决。</p>
<h4 id="12-11-以委托取代超类（Replace-Suberclass-with-Delegate）"><a href="#12-11-以委托取代超类（Replace-Suberclass-with-Delegate）" class="headerlink" title="12.11 以委托取代超类（Replace Suberclass with Delegate）"></a>12.11 以委托取代超类（Replace Suberclass with Delegate）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">List</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> <span class="keyword">extends</span> <span class="title class_ inherited__">List</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>重构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_storage</span> = <span class="keyword">new</span> <span class="title class_">List</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">List</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><br>在对象技术发展的早期，有一个经典误用继承的例子：让 Stack 继承 List。出发点是想复用列表类的数据存储和操作能力。但其中大部分操作对栈来说不适用。更好的办法是把列表作为栈的字段，把必要操作委派给列表。（是用代理模式吗？）</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E7%AB%A0-%E7%AC%AC%E4%B8%80%E7%BB%84%E9%87%8D%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">6章 第一组重构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E6%8F%90%E7%82%BC%E5%87%BD%E6%95%B0%EF%BC%88Extract-Function%EF%BC%89"><span class="toc-number">2.0.1.</span> <span class="toc-text">6.1 提炼函数（Extract Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0%EF%BC%88Inline-Function%EF%BC%89"><span class="toc-number">2.0.2.</span> <span class="toc-text">6.2 内联函数（Inline Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%E6%8F%90%E7%82%BC%E5%8F%98%E9%87%8F%EF%BC%88Extract-Variable%EF%BC%89"><span class="toc-number">2.0.3.</span> <span class="toc-text">6.3提炼变量（Extract Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%86%85%E8%81%94%E5%8F%98%E9%87%8F%EF%BC%88Inline-Variable%EF%BC%89"><span class="toc-number">2.0.4.</span> <span class="toc-text">6.4 内联变量（Inline Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-%E6%94%B9%E5%8F%98%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%EF%BC%88Change-Function-Declaration%EF%BC%89"><span class="toc-number">2.0.5.</span> <span class="toc-text">6.5 改变函数声明（Change Function Declaration）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-%E5%B0%81%E8%A3%85%E5%8F%98%E9%87%8F%EF%BC%88Encapsulate-VAriable%EF%BC%89"><span class="toc-number">2.0.6.</span> <span class="toc-text">6.6 封装变量（Encapsulate VAriable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7-%E5%8F%98%E9%87%8F%E6%94%B9%E5%90%8D%EF%BC%88Rename-Variable%EF%BC%89"><span class="toc-number">2.0.7.</span> <span class="toc-text">6.7 变量改名（Rename Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-%E5%BC%95%E5%85%A5%E5%8F%82%E6%95%B0%E5%8F%98%E9%87%8F%EF%BC%88Introduce-Parameter%EF%BC%89"><span class="toc-number">2.0.8.</span> <span class="toc-text">6.8 引入参数变量（Introduce Parameter）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88%E6%88%90%E7%B1%BB%EF%BC%88Combine-Function-into-Classs%EF%BC%89"><span class="toc-number">2.0.9.</span> <span class="toc-text">6.9 函数组合成类（Combine Function into Classs）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E7%AB%A0-%E5%B0%81%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">7章 封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E5%B0%81%E8%A3%85%E8%AE%B0%E5%BD%95%EF%BC%88Encapsulate-Record%EF%BC%89"><span class="toc-number">3.0.1.</span> <span class="toc-text">7.1 封装记录（Encapsulate Record）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%B0%81%E8%A3%85%E9%9B%86%E5%90%88%EF%BC%88Encapsulate-Collection%EF%BC%89"><span class="toc-number">3.0.2.</span> <span class="toc-text">7.2 封装集合（Encapsulate Collection）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E4%BB%A5%E5%AF%B9%E8%B1%A1%E5%8F%96%E4%BB%A3%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%EF%BC%88Replace-Primitive-with-Object%EF%BC%89"><span class="toc-number">3.0.3.</span> <span class="toc-text">7.3 以对象取代基本类型（Replace Primitive with Object）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%8F%96%E4%BB%A3%E4%B8%B4%E6%97%B6%E5%8F%98%E9%87%8F-%EF%BC%88Replace-Temp-with-Query%EF%BC%89"><span class="toc-number">3.0.4.</span> <span class="toc-text">7.4 以查询取代临时变量 （Replace Temp with Query）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-%E6%8F%90%E7%82%BC%E7%B1%BB%EF%BC%88Extract-Class%EF%BC%89"><span class="toc-number">3.0.5.</span> <span class="toc-text">7.5 提炼类（Extract Class）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-%E5%86%85%E8%81%94%E7%B1%BB%EF%BC%88Inline-Class%EF%BC%89"><span class="toc-number">3.0.6.</span> <span class="toc-text">7.6 内联类（Inline Class）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-7-%E9%9A%90%E8%97%8F%E5%A7%94%E6%89%98%E5%85%B3%E7%B3%BB%EF%BC%88Hide-Delegat%EF%BC%89"><span class="toc-number">3.0.7.</span> <span class="toc-text">7.7 隐藏委托关系（Hide Delegat）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-8-%E7%A7%BB%E9%99%A4%E4%B8%AD%E9%97%B4%E4%BA%BA%EF%BC%88Remove-Middle-Man%EF%BC%89"><span class="toc-number">3.0.8.</span> <span class="toc-text">7.8 移除中间人（Remove Middle Man）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-9-%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%95%EF%BC%88Subtitute-Algorithm%EF%BC%89"><span class="toc-number">3.0.9.</span> <span class="toc-text">7.9 替换算法（Subtitute Algorithm）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E7%AB%A0-%E6%90%AC%E7%A7%BB%E7%89%B9%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text">8章 搬移特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E6%90%AC%E7%A7%BB%E5%87%BD%E6%95%B0"><span class="toc-number">4.0.1.</span> <span class="toc-text">8.1 搬移函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E6%90%AC%E7%A7%BB%E5%AD%97%E6%AE%B5%EF%BC%88Move-Field%EF%BC%89"><span class="toc-number">4.0.2.</span> <span class="toc-text">8.2 搬移字段（Move Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E6%90%AC%E7%A7%BB%E8%AF%AD%E5%8F%A5%E5%88%B0%E5%87%BD%E6%95%B0%EF%BC%88Move-Statements-into-Function%EF%BC%89"><span class="toc-number">4.0.3.</span> <span class="toc-text">8.3 搬移语句到函数（Move Statements into Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E6%90%AC%E7%A7%BB%E8%AF%AD%E5%8F%A5%E5%88%B0%E8%B0%83%E7%94%A8%E8%80%85%EF%BC%88Move-Statements-to-Callers%EF%BC%89"><span class="toc-number">4.0.4.</span> <span class="toc-text">8.4 搬移语句到调用者（Move Statements to Callers）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-%E4%BB%A5%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%8F%96%E4%BB%A3%E5%86%85%E8%81%94%E4%BB%A3%E7%A0%81%EF%BC%88Replace-Inline-Code-with-Function-Call%EF%BC%89"><span class="toc-number">4.0.5.</span> <span class="toc-text">8.5 以函数调用取代内联代码（Replace Inline Code with Function Call）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6-%E7%A7%BB%E5%8A%A8%E8%AF%AD%E5%8F%A5%EF%BC%88Slide-Statements%EF%BC%89"><span class="toc-number">4.0.6.</span> <span class="toc-text">8.6 移动语句（Slide Statements）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-%E6%8B%86%E5%88%86%E5%BE%AA%E7%8E%AF%EF%BC%88Split-Loop%EF%BC%89"><span class="toc-number">4.0.7.</span> <span class="toc-text">8.7 拆分循环（Split Loop）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-%E4%BB%A5%E7%AE%A1%E9%81%93%E5%8F%96%E4%BB%A3%E5%BE%AA%E7%8E%AF%EF%BC%88Replace-Loop-with-Pipeline%EF%BC%89"><span class="toc-number">4.0.8.</span> <span class="toc-text">8.8 以管道取代循环（Replace Loop with Pipeline）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-9-%E7%A7%BB%E9%99%A4%E6%AD%BB%E4%BB%A3%E7%A0%81%EF%BC%88Remove-Dead-Code%EF%BC%89"><span class="toc-number">4.0.9.</span> <span class="toc-text">8.9 移除死代码（Remove Dead Code）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E7%AB%A0-%E9%87%8D%E6%96%B0%E7%BB%84%E7%BB%87%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">9章 重新组织数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-%E6%8B%86%E5%88%86%E5%8F%98%E9%87%8F%EF%BC%88Split-Variable%EF%BC%89"><span class="toc-number">5.0.1.</span> <span class="toc-text">9.1 拆分变量（Split Variable）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-%E5%AD%97%E6%AE%B5%E6%94%B9%E5%90%8D%EF%BC%88Rename-Field%EF%BC%89"><span class="toc-number">5.0.2.</span> <span class="toc-text">9.2 字段改名（Rename Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%8F%96%E4%BB%A3%E6%B4%BE%E7%94%9F%E5%8F%98%E9%87%8F%EF%BC%88Replace-Derived-Variable-with-Query%EF%BC%89"><span class="toc-number">5.0.3.</span> <span class="toc-text">9.3 以查询取代派生变量（Replace Derived Variable with Query）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-4-%E5%B0%86%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%E6%94%B9%E4%B8%BA%E5%80%BC%E5%AF%B9%E8%B1%A1%EF%BC%88Change-Reference-to-Value%EF%BC%89"><span class="toc-number">5.0.4.</span> <span class="toc-text">9.4 将引用对象改为值对象（Change Reference to Value）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-%E5%B0%86%E5%80%BC%E5%AF%B9%E8%B1%A1%E6%94%B9%E4%B8%BA%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%EF%BC%88Change-Value-to-Reference%EF%BC%89"><span class="toc-number">5.0.5.</span> <span class="toc-text">9.5 将值对象改为引用对象（Change Value to Reference）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E7%AB%A0-%E7%AE%80%E5%8C%96%E6%9D%A1%E4%BB%B6%E9%80%BB%E8%BE%91"><span class="toc-number">6.</span> <span class="toc-text">10章 简化条件逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-%E5%88%86%E8%A7%A3%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Decompose-Conditional%EF%BC%89"><span class="toc-number">6.0.1.</span> <span class="toc-text">10.1 分解条件表达式（Decompose Conditional）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-%E5%90%88%E5%B9%B6%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Consilidate-Conditional-Expression%EF%BC%89"><span class="toc-number">6.0.2.</span> <span class="toc-text">10.2 合并条件表达式（Consilidate Conditional Expression）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-%E4%BB%A5%E5%8D%AB%E8%AF%AD%E5%8F%A5%E5%8F%96%E4%BB%A3%E5%B5%8C%E5%A5%97%E6%B7%BB%E5%8A%A0%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Replace-Nested-Conditional-with-Guard-Clauses%EF%BC%89"><span class="toc-number">6.0.3.</span> <span class="toc-text">10.3 以卫语句取代嵌套添加表达式（Replace Nested Conditional with Guard Clauses）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-%E4%BB%A5%E5%A4%9A%E6%80%81%E5%8F%96%E4%BB%A3%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88Replace-Conditional-with-Polymorphism%EF%BC%89"><span class="toc-number">6.0.4.</span> <span class="toc-text">10.4 以多态取代条件表达式（Replace Conditional with Polymorphism）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-%E5%BC%95%E5%85%A5%E7%89%B9%E4%BE%8B%EF%BC%88Introduce-Special-Case%EF%BC%89"><span class="toc-number">6.0.5.</span> <span class="toc-text">10.5 引入特例（Introduce Special Case）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-%E5%BC%95%E5%85%A5%E6%96%AD%E8%A8%80%EF%BC%88Introduce-Assertion%EF%BC%89"><span class="toc-number">6.0.6.</span> <span class="toc-text">10.6 引入断言（Introduce Assertion）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E7%AB%A0-%E9%87%8D%E6%9E%84-API"><span class="toc-number">7.</span> <span class="toc-text">11章 重构 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-%E5%B0%86%E6%9F%A5%E8%AF%A2%E5%87%BD%E6%95%B0%E5%92%8C%E4%BF%AE%E6%94%B9%E5%87%BD%E6%95%B0%E5%88%86%E7%A6%BB%EF%BC%88Separate-Query-from-Modifier%EF%BC%89"><span class="toc-number">7.0.1.</span> <span class="toc-text">11.1 将查询函数和修改函数分离（Separate Query from Modifier）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%8C%96%EF%BC%88Parameterize-Function%EF%BC%89"><span class="toc-number">7.0.2.</span> <span class="toc-text">11.2 函数参数化（Parameterize Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-%E7%A7%BB%E9%99%A4%E6%A0%87%E8%AE%B0%E5%8F%82%E6%95%B0%EF%BC%88Remove-Flag-Argument%EF%BC%89"><span class="toc-number">7.0.3.</span> <span class="toc-text">11.3 移除标记参数（Remove Flag Argument）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-%E4%BF%9D%E6%8C%81%E5%AF%B9%E8%B1%A1%E5%AE%8C%E6%95%B4%EF%BC%88Preseve-Whole-Object%EF%BC%89"><span class="toc-number">7.0.4.</span> <span class="toc-text">11.4 保持对象完整（Preseve Whole Object）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-5-%E4%BB%A5%E6%9F%A5%E8%AF%A2%E5%8F%96%E4%BB%A3%E5%8F%82%E6%95%B0%EF%BC%88Replace-Parameter-with-Query%EF%BC%89"><span class="toc-number">7.0.5.</span> <span class="toc-text">11.5 以查询取代参数（Replace Parameter with Query）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-6-%E4%BB%A5%E5%8F%82%E6%95%B0%E5%8F%96%E4%BB%A3%E6%9F%A5%E8%AF%A2%EF%BC%88Replace-Query-with-Parameter%EF%BC%89"><span class="toc-number">7.0.6.</span> <span class="toc-text">11.6 以参数取代查询（Replace Query with Parameter）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-7-%E7%A7%BB%E9%99%A4%E8%AE%BE%E5%80%BC%E5%87%BD%E6%95%B0%EF%BC%88Remove-Setting-Method%EF%BC%89"><span class="toc-number">7.0.7.</span> <span class="toc-text">11.7 移除设值函数（Remove Setting Method）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-8-%E4%BB%A5%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0%E5%8F%96%E4%BB%A3%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%EF%BC%88Replace-Constructor-with-Factory-Function%EF%BC%89"><span class="toc-number">7.0.8.</span> <span class="toc-text">11.8 以工厂函数取代构造函数（Replace Constructor with Factory Function）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-9-%E4%BB%A5%E5%91%BD%E4%BB%A4%E5%8F%96%E4%BB%A3%E5%87%BD%E6%95%B0%EF%BC%88Replace-Function-with-Command%EF%BC%89"><span class="toc-number">7.0.9.</span> <span class="toc-text">11.9 以命令取代函数（Replace Function with Command）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-10-%E4%BB%A5%E5%87%BD%E6%95%B0%E5%8F%96%E4%BB%A3%E5%91%BD%E4%BB%A4%EF%BC%88Replace-Command-with-Function%EF%BC%89"><span class="toc-number">7.0.10.</span> <span class="toc-text">11.10 以函数取代命令（Replace Command with Function）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E7%AB%A0-%E5%A4%84%E7%90%86%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">8.</span> <span class="toc-text">12章 处理继承关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1-%E5%87%BD%E6%95%B0%E4%B8%8A%E7%A7%BB%EF%BC%88Pull-Up-Method%EF%BC%89"><span class="toc-number">8.0.1.</span> <span class="toc-text">12.1 函数上移（Pull Up Method）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-%E5%AD%97%E6%AE%B5%E4%B8%8A%E7%A7%BB%EF%BC%88Pull-Up-Field%EF%BC%89"><span class="toc-number">8.0.2.</span> <span class="toc-text">12.2 字段上移（Pull Up Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-3-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%9C%AC%E4%BD%93%E4%B8%8A%E7%A7%BB%EF%BC%88Pull-Up-Constructor-Body%EF%BC%89"><span class="toc-number">8.0.3.</span> <span class="toc-text">12.3 构造函数本体上移（Pull Up Constructor Body）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-4-%E5%87%BD%E6%95%B0%E4%B8%8B%E7%A7%BB%EF%BC%88Push-Down-Method%EF%BC%89"><span class="toc-number">8.0.4.</span> <span class="toc-text">12.4 函数下移（Push Down Method）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-5-%E5%AD%97%E6%AE%B5%E4%B8%8B%E7%A7%BB%EF%BC%88Push-Down-Field%EF%BC%89"><span class="toc-number">8.0.5.</span> <span class="toc-text">12.5 字段下移（Push Down Field）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-%E4%BB%A5%E5%AD%90%E7%B1%BB%E5%8F%96%E4%BB%A3%E7%B1%BB%E5%9E%8B%E7%A0%81%EF%BC%88Replace-Type-Code-with-Subclasses%EF%BC%89"><span class="toc-number">8.0.6.</span> <span class="toc-text">12.6 以子类取代类型码（Replace Type Code with Subclasses）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-%E7%A7%BB%E9%99%A4%E5%AD%90%E7%B1%BB%EF%BC%88Remove-Subclass%EF%BC%89"><span class="toc-number">8.0.7.</span> <span class="toc-text">12.7 移除子类（Remove Subclass）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-8-%E6%8F%90%E7%82%BC%E8%B6%85%E7%B1%BB%EF%BC%88Extract-Superclass%EF%BC%89"><span class="toc-number">8.0.8.</span> <span class="toc-text">12.8 提炼超类（Extract Superclass）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-9-%E6%8A%98%E5%8F%A0%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB%EF%BC%88Collapse-Hierarchy%EF%BC%89"><span class="toc-number">8.0.9.</span> <span class="toc-text">12.9 折叠继承体系（Collapse Hierarchy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-10-%E4%BB%A5%E5%A7%94%E6%89%98%E5%8F%96%E4%BB%A3%E5%AD%90%E7%B1%BB%EF%BC%88Replace-Subclass-with-Edlegate%EF%BC%89"><span class="toc-number">8.0.10.</span> <span class="toc-text">12.10 以委托取代子类（Replace Subclass with Edlegate）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-11-%E4%BB%A5%E5%A7%94%E6%89%98%E5%8F%96%E4%BB%A3%E8%B6%85%E7%B1%BB%EF%BC%88Replace-Suberclass-with-Delegate%EF%BC%89"><span class="toc-number">8.0.11.</span> <span class="toc-text">12.11 以委托取代超类（Replace Suberclass with Delegate）</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&text=读《重构》"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&is_video=false&description=读《重构》"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=读《重构》&body=Check out this article: http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&title=读《重构》"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&name=读《重构》&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2020/11/20/%E8%AF%BB%E3%80%8A%E9%87%8D%E6%9E%84%E3%80%8B/&t=读《重构》"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    liu Amon
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">项目</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
